!function(t){var e={};function a(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=e,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(n,i,function(e){return t[e]}.bind(null,i));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=0)}([function(t,e,a){"use strict";a.r(e);var n=class{constructor(t,e){this.target=t,this.name="createShape",this.UnRedo=e}action(){["Rect","Circle","Textbox"].forEach(t=>{const e=document.createElement("li");e.id=t,e.className="tag",e.addEventListener("click",()=>{this.target.isDrawingMode=!1,this.selectType(t)}),document.getElementById("tag-wrapper").appendChild(e)})}selectType(t){let e,a;this.target.renderAll(),this.target.forEachObject((function(t){t.selectable=!1})),"Textbox"===t?this.target.on("mouse:down",t=>{e=t.absolutePointer.x,a=t.absolutePointer.y;const n=new fabric.Textbox("this is sample",{left:e,top:a});this.target.add(n),this.target.renderAll(),this.target.forEachObject((function(t){t.selectable=!0})),this.target.off("mouse:down"),this.UnRedo.updateCanvas()}):(console.log("hello"),this.target.on("mouse:down",t=>{e=t.absolutePointer.x,a=t.absolutePointer.y}),this.target.on("mouse:up",n=>{const i=n.absolutePointer.x,o=n.absolutePointer.y;this.create(e,a,i,o,t),this.target.off("mouse:down"),this.target.off("mouse:up"),this.target.renderAll(),this.target.forEachObject((function(t){t.selectable=!0})),this.UnRedo.updateCanvas()}))}create(t,e,a,n,i){let o,s;t-a>0&&e-n>0?(o=a,s=n):t-a>0&&e-n<0?(o=a,s=e):t-a<0&&e-n>0?(o=t,s=n):(o=t,s=e);const r={left:o,top:s,fill:"#ccc",stroke:"#000"};if("Rect"===i){const i=new fabric.Rect({...r,width:Math.abs(t-a),height:Math.abs(e-n)});console.log("hi"),this.target.add(i)}else{const e=new fabric.Circle({...r,radius:Math.abs(t-a)/2});console.log("hi"),this.target.add(e)}}};var i=class{constructor(t){this.name="UnRedo",this.target=t,this.mods=0,this.state=[],this.isUndo=!1,this.target.on("object:modified",()=>{this.updateCanvas()}),this.target.on("path:created",()=>{this.updateCanvas()}),this.target.on("object:removed",()=>{this.updateCanvas()})}action(){window.addEventListener("keydown",t=>{"z"===t.key&&t.ctrlKey?this.undo():"y"===t.key&&t.ctrlKey&&this.redo()})}updateCanvas(){for(;this.isUndo;)this.state.pop(),this.isUndo--,this.mods=0;const t=JSON.stringify(this.target);this.state.push(t),console.log(this.state)}undo(){this.mods<this.state.length&&(this.target.clear().renderAll(),this.target.loadFromJSON(this.state[this.state.length-this.mods-2]),this.isUndo=this.mods+1,this.target.renderAll(),console.log(this.state.length-1-this.mods-1),this.mods+=1)}redo(){this.mods>0&&(this.target.clear().renderAll(),this.target.loadFromJSON(this.state[this.state.length-this.mods]),this.target.renderAll(),this.isUndo=this.mods-1,console.log(this.state.length-1-this.mods+1),this.mods-=1)}};var o=class{constructor(t){this.target=t,this.name="drawing",window.onkeydown=t=>{"y"===t.key&&(this.target.isDrawingMode=!this.target.isDrawingMode)}}action(){this.target.isDrawingMode=!this.target.isDrawingMode}};var s=class{constructor(t,e,a){this.target=t,this.array=e,this.user=a}action(){this.displayModal(),console.log(JSON.parse(localStorage.getItem("data"))),document.getElementById("submit").addEventListener("click",()=>{const t=new Date;this.array.unshift({userName:this.user,title:document.getElementById("title").value,explanation:document.getElementById("explanation").value,date:t.getMonth()+1+"/"+t.getDate()+"/"+t.getHours()+":"+t.getMinutes(),data:JSON.stringify(this.target),icon:"../../Menu/img/icon.png"}),localStorage.setItem("data",JSON.stringify(this.array)),window.location.href="../../Menu/html/index.html"})}displayModal(){const t=document.createElement("div"),e=document.createElement("div"),a=document.createElement("input"),n=document.createElement("textarea"),i=document.createElement("button");t.id="modal-wrapper",e.id="modal",a.id="title",a.placeholder="タイトル",n.id="explanation",n.placeholder="作品の説明",i.id="submit",i.innerHTML="投稿",document.body.appendChild(t),t.appendChild(e),e.appendChild(a),e.appendChild(n),e.appendChild(i)}};const r=new class{constructor(){this.canvasSize=document.getElementById("canvas"),this.canvasSize.height=document.getElementById("canvas-wrapper").clientHeight,this.canvasSize.width=document.getElementById("canvas-wrapper").clientWidth,this.board=new fabric.Canvas("canvas"),this.board.freeDrawingBrush.color="#2b2b2b",this.board.freeDrawingBrush.width=8}resize(){this.board.setWidth(window.innerWidth),this.board.setWidth(window.innerHeight)}createTool(t){const e=document.getElementById("tag-wrapper"),a=document.createElement("li");a.className="tag",a.id=t,e.appendChild(a)}};window.onresize=async()=>{const t=document.getElementById("canvas-wrapper");r.board.setWidth(t.clientWidth),r.board.setHeight(t.clientHeight)};const d=new i(r.board),l=new n(r.board,d),c=new o(r.board),h=new s(r.board,timelineLog,"damegane");d.action(),window.onkeydown=t=>{"y"===t.key?r.board.isDrawingMode=!r.board.isDrawingMode:"Delete"===t.key&&r.board.remove.apply(r.board,r.board.getActiveObjects())},window.onload=()=>{Array(c,l,h).forEach(t=>{r.createTool(t.name),document.getElementById(t.name).addEventListener("click",()=>{t.action()})})}}]);